{% extends 'Tasks/layout.html' %}

{% block body %}
      <div class="container" id="tasks_page_container">
        <h1>Tasks</h1>
        {% if user.is_authenticated %}
        <div id="tasks_section">
        <div class="tasks_container" id="uncompleted_tasks_container">
          {% for task in tasks %}
          {% if task.completed == False %}
                  <div class="row" style="padding-left: 20px; padding-right:20px;" id='taskContainer_{{task.id}}'>
                    <div class="form-check">
                      {% if task.completed == True %}
                        <input class="form-check-input" type="checkbox" value="" data-task-id="{{ task.id }}" checked>
                      {% else %}
                        <input class="form-check-input" type="checkbox" value="" data-task-id="{{ task.id }}">
                      {% endif %}
                      <label class="form-check-label d-flex justify-content-between" for="flexCheckDefault">
                          <div class="col-8 col-md-8">{{ task.task }}</div>
                          
                          {% if task.target_date != None %}
                            {% if task.target_date|date:"Y-m-d" > now|date:"Y-m-d" %}
                                <div class="col-2 col-md-2 due">{{ task.target_date|date:"M d" }}</div>
                            {% elif task.target_date|date:"Y-m-d" == now|date:"Y-m-d" %}
                                <div class="col-2 col-md-2 due" style="color: blue;">Today</strong></div>
                            {% else %}
                                <div class="col-2 col-md-2 danger due">{{ task.target_date|date:"M d" }}</div>
                            {% endif %}
                          {% else %}
                              <div class="col-2 col-md-2"></div>
                          {% endif %}

                          {% if task.target_time != None %}
                              <div class="col-2 col-md-2 due">{{ task.target_time }}</div>
                          {% else %}
                              <div class="col-2 col-md-2"></div>
                          {% endif %}
                        </div>
                      </label>
                  </div>
              {% endif %}
              {% endfor %}
            </div>
            

            <div class="tasks_container" id="completed_tasks_container">
              <div class="accordion">
              <div class="accordion-item">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  <span class="mont-bold">Completed</span>
                </button>

                <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                  <div class="accordion-body" id="completed_accordion">
                    
                {% for task in tasks %}
                {% if task.completed == True %}
                  <div class="row" style="padding-left: 20px; padding-right:20px;" id='taskContainer_{{task.id}}'>
                    <div class="form-check">
                      {% if task.completed == True %}
                        <input class="form-check-input" type="checkbox" value="" data-task-id="{{ task.id }}" checked>
                      {% else %}
                        <input class="form-check-input" type="checkbox" value="" data-task-id="{{ task.id }}">
                      {% endif %}
                      <label class="form-check-label d-flex justify-content-between" for="flexCheckDefault">
                          <div class="col-8 col-md-8">{{ task.task }}</div>
                          
                          {% if task.target_date != None %}
                            {% if task.target_date|date:"Y-m-d" > now|date:"Y-m-d" %}
                                <div class="col-2 col-md-2 due">{{ task.target_date|date:"M d" }}</div>
                            {% elif task.target_date|date:"Y-m-d" == now|date:"Y-m-d" %}
                                <div class="col-2 col-md-2 due" style="color: blue;">Today</strong></div>
                            {% else %}
                                <div class="col-2 col-md-2 danger due">{{ task.target_date|date:"M d" }}</div>
                            {% endif %}
                          {% else %}
                              <div class="col-2 col-md-2"></div>
                          {% endif %}

                          {% if task.target_time != None %}
                              <div class="col-2 col-md-2 due">{{ task.target_time }}</div>
                          {% else %}
                              <div class="col-2 col-md-2"></div>
                          {% endif %}
                        </div>
                      </label>
                  </div>
              {% endif %}
              {% endfor %}
              </div>

              
            </div>
          </div>
          </div>
          </div>
        </div>
        
              <div>
              <button class="btn btn-primary blue_btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#staticBackdrop" aria-controls="staticBackdrop" id="plus">
                  +
              </button>
                
                <div class="offcanvas offcanvas-start" data-bs-backdrop="static" tabindex="-1" id="staticBackdrop" aria-labelledby="staticBackdropLabel">
                  <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="staticBackdropLabel">Add New Task</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                  </div>
                  <div class="offcanvas-body">
                    <div>
                      <form action="{% url 'new_task' %}" id="newTaskForm" method="post">
                          {% csrf_token %}
                          {{ new_task_form.non_field_errors }}
                            <div class="fieldWrapper" id="taskTitle">
                              <label for="{{ new_task_form.task.id_for_label }}">What do you need to do?</label>
                              {{new_task_form.task}}
                            </div>
                            
                                <div class="fieldWrapper">
                                  <label for="{{ new_task_form.target_date.id_for_label }}">&#x1F4C5; Due Date:</label>
                                  {{new_task_form.target_date}}
                                </div>
                                <div class="fieldWrapper">
                                  <label for="{{ new_task_form.target_time.id_for_label }}">&#x23F0; Time:</label>
                                  {{new_task_form.target_time}}
                                </div>
                          <input type="submit" value="Add Task" class="submit_btn blue_btn">
                      </form>
                    </div>
                  </div>
                </div>
          {% else %}
          <div class="central_alert ">
            <p>Please login to view or add to your tasks.</p>
            <button class='blue_btn central_alert_btn'>
              <a href="{% url 'register' %}">Register</a>
            </button>
            <button class='blue_btn central_alert_btn'>
              <a href="{% url 'login' %}">Login</a>
            </button>
          </div>
          {% endif %}
        </div>
      
{% endblock %}